$(function(){var c=new Date();var g=c.getDate(),a=c.getMonth(),h=c.getFullYear();var b=false;var e=function(){setTimeout(function(){$(".fc-event").popover({placement:"bottom",content:'<div class="btn-group"><button type="button" class="btn btn-xs red-mint">Eliminar</button><button type="button" class="btn btn-xs btn-default">Editar</button></div>',html:true,container:"body"});$(".fc-event").on("show.bs.popover",function(){$(".popover").popover("hide")})},200)};var f;$("#calendar-place").fullCalendar({lang:"es",header:{left:"today",center:"title",right:"prev,next,month,agendaWeek,agendaDay"},events:{url:Routing.generate("fullcalendar_loadevents",{month:moment().format("MM"),year:moment().format("YYYY")}),color:"blue",textColor:"white",success:function(){e()},error:function(){alert("Error receving events")}},eventReceive:function(k){if(!k.allDay&&k.type==vacaciones_id){alert("Esta afectación tiene que ser un evento para todo el día.");var j=$('.fc-content:contains("'+k.start.format("H:mm")+'")');j.each(function(){if($(this).find('.fc-title:contains("'+k.title+'")').length==1){$("#calendar-place").fullCalendar("removeEvents",k._id);$(this).parents(".fc-event").remove()}});return}var l=k.start.format("YYYY-MM-DD HH:mm");var i=$(".fc-agendaDay-button").hasClass("fc-state-active");var d=(k.end==null&&i)?moment(l).add(2,"hours").format("YYYY-MM-DD HH:mm"):(i)?k.end.format("YYYY-MM-DD HH:mm"):l;$.ajax({url:Routing.generate("fullcalendar_store"),data:{notify:k.notify,start:l,end:d,title:k.title,allDay:(k.allDay)?1:0,color:k.color,affected:k.affected,type:k.type,desc:k.desc},type:"POST",dataType:"json",success:function(m){console.log("ok");k.id=m.id;$("#calendar-place").fullCalendar("updateEvent",k);$('.panel-title:contains("'+k.title+'")').parents(".panel").remove();e()},error:function(){alert("Error processing your request")}})},viewRender:function(d,i){var k=d.calendar.getDate().format("MM");var j=d.calendar.getDate().format("YYYY");e()},eventDrop:function(k,o,j){if(!k.allDay&&k.backgroundColor===vacaciones_color){alert("Esta afectación tiene que ser un evento para todo el día.");j(k);return}var n=k.start.format("YYYY-MM-DD");var l=(k.end==null)?n:k.end.format("YYYY-MM-DD");var i=(($(".fc-agendaDay-button").hasClass("fc-state-active")||$(".fc-agendaWeek-button").hasClass("fc-state-active"))&&!k.allDay);var m=(!i)?n:k.start.format("YYYY-MM-DD HH:mm");var d=(!i)?l:(k.end!==null)?k.end.format("YYYY-MM-DD HH:mm"):moment(m).add(2,"hours").format("YYYY-MM-DD HH:mm");console.log("is dayView: "+i);console.log(m+" "+d);$.ajax({url:Routing.generate("fullcalendar_changedate"),data:{id:k.id,newStartData:m,newEndData:d,allDay:k.allDay},type:"POST",dataType:"json",success:function(p){console.log("ok");e()},error:function(p){j();alert("Error processing your request: "+p.responseText)}})},eventResize:function(k,l,j){var d=(($(".fc-agendaDay-button").hasClass("fc-state-active")||$(".fc-agendaWeek-button").hasClass("fc-state-active"))&&!k.allDay);var i=(!d)?k.end.format("YYYY-MM-DD"):(k.end!==null)?k.end.format("YYYY-MM-DD HH:mm"):moment(start).add(2,"hours").format("YYYY-MM-DD HH:mm");$.ajax({url:Routing.generate("fullcalendar_resizedate"),data:{id:k.id,newDate:i},type:"POST",dataType:"json",success:function(m){console.log("ok");e()},error:function(m){j();alert("Error processing your request: "+m.responseText)}})},eventMouseover:function(j,i,d){f=j},eventClick:function(k,i,d){console.log("Event: "+k.title);console.log("Event: "+k.id);var j=moment().format("YYYY-MM-DD");if(moment(j)>moment(k.start.format("YYYY-MM-DD"))){$(".popover:visible").popover("hide")}$(".popover").find(".btn-default").on("click",function(){$.ajax({url:Routing.generate("fullcalendar_view"),data:{id:k.id},dataType:"json",type:"POST",success:function(l){$(".popover").popover("hide");$("#form_nombre").val(l.title);$("#form_tipo").val(l.type).trigger("change.select2");$("#form_descripcion").val(l.desc);$("#crearModal").attr("data-affected",l.affected);$("#crearModal").attr("data-event",k.id);$("#crearModal").attr("data-allDay",k.allDay);$("#crearModal").modal("show");k.color="#000"},error:function(){alert("Ha ocurrido un error");$(".popover").popover("hide")}})});$(".popover").find(".red-mint").on("click",function(){var l=$(this).parents(".popover");$(".popover").popover("hide");var m=$('[aria-describedby="'+l.attr("id")+'"]');if(confirm("¿Desea eliminar la Afectación?")){$.ajax({url:Routing.generate("fullcalendar_remove"),data:{id:k.id},type:"POST",dataType:"json",success:function(n){alert("Se elimino la Afectación correctamente.");$("#calendar-place").fullCalendar("removeEvents",k._id);m.remove()},error:function(n){alert("Error processing your request: "+n.responseText)}})}})},editable:true,droppable:true})});